docker run -dit --name "second" -p 2222:22 -p 8080:80 ubuntu:22.04


1. Entra nel container

docker exec -it second bash

1.1 Se container su un'altra macchina

ssh nomeutente@ip.ip.ip.ip port

2. Installa SSH e Nano

apt update
apt install -y openssh-server sudo
apt install -y nano sudo

3. Crea la directory SSH

mkdir /var/run/sshd

4. Crea un utente (NO root)

adduser nuovouser
usermod -aG sudo nuovouser

5. Configura SSH

nano /etc/ssh/sshd_config

6. Trovare e decommentare

Port 22
PasswordAuthentication yes
PubkeyAuthentication yes

6.1 Cambiare

PermitRootLogin no

7. Avvia ssh

service ssh start

8. Su HOST

ssh-keygen -t ed25519 -C "nuovouser"

Premi invio a tutto.

Le chiavi saranno in:
~/.ssh/id_ed25519
~/.ssh/id_ed25519.pub

9. Copiare la chiave pubblica nel container

ssh-copy-id -p 2222 nuovoutente@ip.ip.ip.ip

Inserisci la password dell'utente (nuovoutente)

9.1 Per copiare la chiave se manca ssh-copy-id

Su CONTAINER
mkdir -p /home/nuovoutente/.ssh
chmod 700 /home/nuovoutente/.ssh
nano /home/nuovoutente/.ssh/authorized_keys

Su HOST

cat ~/.ssh/id_ed25519.pub

Copia tutto il cat in /home/nuovoutente/.ssh/authorized_keys

Su CONTAINER

chmod 600 /home/nuovoutente/.ssh/authorized_keys
chown -R nuovoutente:nuovoutente /home/nuovoutente/.ssh

10. Login SSH senza password

ssh -p 2222 nuovoutente@ip.ip.ip.ip
